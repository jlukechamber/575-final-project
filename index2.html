<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Fly to a location based on scroll position</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
    #map {
        position: fixed;
        width: 50%;
    }
    #features {
        width: 50%;
        margin-left: 50%;
        font-family: sans-serif;
        overflow-y: scroll;
        background-color: #fafafa;
    }
    section {
        padding: 25px 50px;
        line-height: 25px;
        border-bottom: 1px solid #ddd;
        opacity: 0.25;
        font-size: 13px;
    }
    section.active {
        opacity: 1;
    }
    section:last-child {
        border-bottom: none;
        margin-bottom: 200px;
    }
</style>

<div id="map"></div>
<div id="features">
    <!-- put in another section (and add to array) so there is a different opening frame? with the credits to logan? changing (decreasing pitch is kinda a cool animation?) -->
    <section id="body" class="active">
        <h3>mBody.</h3>
        <p>
            mbody paragraph
        </p>
    </section>
    <section id="conciousness">
        <h3>Conciousness</h3>
        <p>
            conciousness paragraph
        </p>
    </section>
    <section id="subjectivity">
        <h3>Subjectivity</h3>
        <p>
            subjectivity paragraph
        </p>
    </section>
    <section id="ego">
        <h3>Ego</h3>
        <p>
            ego paragraph
        </p>
    </section>
    <section id="antiego">
        <h3>Antiego</h3>
        <p>
            Antiego
        </p>
    </section>
    <section id="other">
        <h3>Other</h3>
        <p>
            other paragraph
        </p>
    </section>
    <section id="Will">
        <h3>Will</h3>
        <p>
            Will paragraph
        </p>
    </section>
    <section id="freedom">
        <h3>Freedom</h3>
        <p>
            freedom paragraph
        </p>
    <section id="unconsciousness">
        <h3>Unconsciousness</h3>
        <p>
            unconsciousness paragraph
        </p>
    <section id="objectivity">
        <h3>Objectivity</h3>
        <p>
            objectivity paragraph
        </p>
        <small id="citation">
            Adapted from
            <a href="http://www.gutenberg.org/files/2346/2346-h/2346-h.htm">Project Gutenberg</a>
        </small>
    </section>
</div>
<script>
	mapboxgl.accessToken = 'pk.eyJ1IjoicmFuZGltYWVzIiwiYSI6ImNsYTJveDBuMzBqOTkzcG1oZ3dyNXE5ZjEifQ.KopBuoAxGQO2d1NO_sNSOA';
    const map = new mapboxgl.Map({
        container: 'map',
        // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
        style: 'mapbox://styles/randimaes/clh418hoa019301p477eg0jbm',
        center: [-152.4691482, 36.1755150],
        zoom: 6,
        bearing: 2,
        pitch: 70
    });

    const chapters = {
        'body': {
            bearing: 27,
            center: [-154.1422696, 35.7988407],
            zoom: 8,
            pitch: 0
        },
        'conciousness': {
            duration: 6000,
            center: [-153.4242405, 36.1905128],
            
            zoom: 8,
            pitch: 0
        },
        'subjectivity': {
            bearing: 90,
            center: [-152.6586802,36.7255401],
            zoom: 8,
            speed: 0.6,
            pitch: 40
        },
        'ego': {
            bearing: 90,
            center: [-151.6775737,36.4988286],
            zoom: 8
        },
        'antiego': {
            bearing: 45,
            center: [-151.1275595, 35.9832893],
            zoom: 8,
            pitch: 20,
            speed: 0.5
        },
        'other': {
            bearing: 180,
            center: [-151.1461410,35.4613327],
            zoom: 8
        },
        'telegraph': {
            bearing: 90,
            center: [-151.5809496,35.7875796],
            zoom: 17.3,
            pitch: 40
        },
        'freedom': {
            bearing: 90,
            center: [-152.4691482, 36.1755150],
            zoom: 8,
            pitch: 20
        },
        'unconsciousness': {
            bearing: 90,
            center: [-153.3573469,35.5006736],
            zoom: 8,
            pitch: 20
        },
        'objectivity': {
            bearing: 90,
            center: [-152.5100277,35.6125384],
            zoom: 8,
            pitch: 20
        }
    };

    let activeChapterName = 'body';
    function setActiveChapter(chapterName) {
        if (chapterName === activeChapterName) return;

        map.flyTo(chapters[chapterName]);

        document.getElementById(chapterName).classList.add('active');
        document.getElementById(activeChapterName).classList.remove('active');

        activeChapterName = chapterName;
    }

    function isElementOnScreen(id) {
        const element = document.getElementById(id);
        const bounds = element.getBoundingClientRect();
        return bounds.top < window.innerHeight && bounds.bottom > 0;
    }

    // On every scroll event, check which element is on screen
    window.onscroll = () => {
        for (const chapterName in chapters) {
            if (isElementOnScreen(chapterName)) {
                setActiveChapter(chapterName);
                break;
            }
        }
    };
</script>

</body>
</html>